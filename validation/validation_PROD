//Set variables
import java.text.*

def MAIL_TO = "kirill.sergeev@rokolabs.com"
def today = new Date()
def yesterday = today.previous()
def formated_date = yesterday.format("yyyyMMdd")
def formated_date_fk = yesterday.format("MMddyy")
println(formated_date)

pipeline {
    agent { label 'vm-roko-jenkins' }
    environment {
        HOST_NAME = 'Prod-Roko-Appserver'
        FORMATED_DATE = "${formated_date}"
        FORMATED_DATE_FK = "${formated_date_fk}"

    }

    stages{
        stage('FileValidation') {
            parallel {
                stage('CIF File validation') { 
                    steps {
                        bat '''
                            echo %FORMATED_DATE%
                            dir "\\\\%HOST_NAME%\\FilesToTransfer\\CIF\\history\\*-%FORMATED_DATE%*.*"
                        '''
                    }
                }

                stage('FirstKey File validation') { 
                    steps {
                        bat '''
                             dir "\\\\%HOST_NAME%\\d$\\Daily Reports\\FirstkeyAutomation\\history\\*_%FORMATED_DATE_FK%.*"
                        '''
                    }
                }

                stage('Paymentus File validation') { 
                    steps {
                        bat '''
                            dir "\\\\%HOST_NAME%\\d$\\FilesToTransfer\\CIF\\history\\*%FORMATED_DATE%*.*"
                        '''
                    }

                }
            }
        }
    }
}